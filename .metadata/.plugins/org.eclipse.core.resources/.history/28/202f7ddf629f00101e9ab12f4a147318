package Parte1;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Comparator;
import java.util.List;
import java.util.Scanner;

public class Ejercicio1 {
	public static void main(String[] args) {
		Scanner sc = new Scanner(System.in);
		int opcion;

		do {
			System.out.println("\n===== MENU DE EJERCICIOS =====");
			System.out.println("1. Mostrar la ruta absoluta de la carpeta actual");
			System.out.println("2. Comprobar ruta y mostrar si es fichero o carpeta");
			System.out.println("3. Mostrar contenido de una carpeta");
			System.out.println("4. Crear carpeta");
			System.out.println("5. Crear fichero");
			System.out.println("6. Renombrar fichero");
			System.out.println("7. Guardar lista de ficheros y mostrar información");
			System.out.println("8. Mostrar contenido recursivamente de una carpeta");
			System.out.println("9. Borrar fichero con confirmación");
			System.out.println("10. Listar archivos de un directorio ordenados por tamaño");
			System.out.println("0. Salir");
			System.out.print("Elige una opción: ");
			opcion = sc.nextInt();
			sc.nextLine();

			switch (opcion) {
			case 1:
				File carpetaActual = new File(".");
				System.out.println("La ruta absoluta de la carpeta actual es:");
				System.out.println(carpetaActual.getAbsolutePath());
				break;

			case 2:
				System.out.println("Introduce una ruta por teclado: ");
				String ruta2 = sc.nextLine();
				File f2 = new File(ruta2);
				if (f2.exists()) {
					if (f2.isFile()) {
						System.out.println("Es un fichero");
						System.out.println("Tamaño: " + f2.length() + " bytes.");
					} else {
						System.out.println("Es una carpeta");
					}
				} else {
					System.out.println("La ruta no existe");
				}
				break;

			case 3:
				System.out.println("Introduce una ruta de carpeta por teclado: ");
				String ruta3 = sc.nextLine();
				File f3 = new File(ruta3);
				if (f3.exists() && f3.isDirectory()) {
					System.out.println("El contenido de " + ruta3 + " es:");
					File[] archivosRuta3 = f3.listFiles();
					if (archivosRuta3 != null) {
						for (File archivo : archivosRuta3) {
							String tipo = archivo.isFile() ? "Fichero" : "Carpeta";
							String permisos = "";
							permisos += archivo.canRead() ? "r" : "-";
							permisos += archivo.canWrite() ? "w" : "-";
							permisos += archivo.canExecute() ? "x" : "-";
							System.out.println("Nombre:" + archivo.getName() + " | " + tipo + " | " + permisos);
						}
					} else {
						System.out.println("Está vacío");
					}
				} else {
					System.out.println("La ruta no existe o no es una carpeta");
				}
				break;

			case 4:
				System.out.println("Introduce una ruta por teclado para crear un directorio: ");
				String ruta4 = sc.nextLine();
				File f4 = new File(ruta4);
				if (!f4.exists()) {
					if (f4.mkdir()) {
						System.out.println("Carpeta creada");
					} else {
						System.out.println("No se pudo crear la carpeta");
					}
				} else {
					System.out.println("La carpeta ya existe en la ruta designada");
				}
				break;

			case 5:
				System.out.println("Introduce una ruta por teclado para crear un archivo: ");
				String ruta5 = sc.nextLine();
				File f5 = new File(ruta5);
				if (!f5.exists()) {
					try {
						if (f5.createNewFile()) {
							System.out.println("Fichero " + f5.getName() + " creado con éxito");
						} else {
							System.out.println("No se pudo crear el fichero");
						}
					} catch (IOException e) {
						e.printStackTrace();
					}
				} else {
					System.out.println("El fichero ya existe");
				}
				break;

			case 6:
				System.out.println("Introduce el nombre del archivo a renombrar:");
				String ruta6 = sc.nextLine();
				File f6 = new File(ruta6);
				if (f6.exists() && f6.isFile()) {
					System.out.println("Introduce el nuevo nombre para el fichero:");
					String nuevoNombre = sc.nextLine();
					String rutaNueva = f6.getAbsolutePath().replace(f6.getName(), nuevoNombre);
					File nuevoNombreFichero = new File(rutaNueva);
					if (!nuevoNombreFichero.exists()) {
						if (f6.renameTo(nuevoNombreFichero)) {
							System.out.println("Fichero renombrado");
						} else {
							System.out.println("No se pudo renombrar el fichero");
						}
					} else {
						System.out.println("El nuevo nombre ya existe");
					}
				} else {
					System.out.println("El fichero no existe");
				}
				break;
			case 7:
				List<String> lista = new ArrayList<String>();
				System.out.println("Introduce nombres de fichero (escribe 'salir' para terminar):");
				int contador = 0;
				while (true) {
					System.out.print("Dame un nombre de fichero: ");
					String nombre = sc.nextLine();
					// File fNombre = new File(nombre);
					if (nombre.equalsIgnoreCase("salir"))
						break;
					lista.add(nombre);
					contador++;
					// contador=lista.size();
					System.out.println("Fichero añadido número: " + contador);
				}
				for (String nombre : lista) {
					File f7 = new File(nombre);
					System.out.println("------------------------------------------------");
					System.out.println(nombre);
					System.out.println("------------------------------------------------");
					if (f7.exists()) {
						if (f7.isFile()) {
							System.out.println("Es un archivo");
						} else {
							System.out.println("Es un directorio");
						}
						System.out.print("El nombre de su ruta absoluta es: " + f7.getAbsolutePath());
						String permisos = "";
						permisos += f7.canRead() ? "r" : "-";
						permisos += f7.canWrite() ? "w" : "-";
						permisos += f7.canExecute() ? "x" : "-";
						System.out.println(permisos);
						System.out.println("El tamaño del archivo es: " + f7.length());

					} else {
						System.out.println("El Archivo no existe");
					}
				}
				break;
			case 8:
				System.out.println("introduce la ruta de la carpeta: ");
				String nombre8 = sc.nextLine();
				File f8 = new File(nombre8);
				if (f8.exists() && f8.isDirectory()) {
					System.out.println("La carpeta " + nombre8 + " tiene de contenido: ");
					mostrarContenido(f8, " ");
				} else {
					System.out.println("La ruta no existe o no es carpeta");
				}
				break;
			case 9:
				System.out.println("Introduce la ruta del fichero que desees borrar: ");
				String nombre9 = sc.nextLine();
				File f9 = new File(nombre9);
				if (f9.exists()) {
					System.out.println("¿Estás seguro de que quieres borrar el fichero? (s/n): ");
					String confirmacion = sc.nextLine();
					if (confirmacion.equalsIgnoreCase("s")) {
						if (f9.delete()) {
							System.out.println("Se ha borrado");
						} else {
							System.out.println("No se ha podido borrar");
						}
					} else {
						System.out.println("Operación cancelada.");
					}

				} else {
					System.out.println("No existe el Fichero");
				}
				break;
			case 10:
				System.out.println("Introduce la ruta del directorio que desees listar: ");
				String nombre10 = sc.nextLine();
				File f10 = new File(nombre10);
				if (f10.exists() && f10.isDirectory()) {
					File[] listado = f10.listFiles();
					if (listado != null) {
						Arrays.sort(listado, Comparator.comparingLong(File::length));
						for (File archivo : listado) {
							System.out.println(archivo.getName() + " - " + archivo.length() + " bytes");
						}

					}
				} else {
					System.out.println("El directorio no existe.");
				}
				break;
			case 0:
				System.out.println("Saliendo del programa");
				break;

			default:
				System.out.println("Opción no válida");
			}

		} while (opcion != 0);

		sc.close();
	}

	private static void mostrarContenido(File carpeta, String espacioB) {
		File[] listado = carpeta.listFiles();
		if (listado != null) {
			for (File f : listado) {
				if (f.isFile()) {
					System.out.println(espacioB + "[A] " + f.getName());
				} else {
					System.out.println(espacioB + "[C] " + f.getName());
					mostrarContenido(f, espacioB + "  ")
				}
			}
		}
	}

}
